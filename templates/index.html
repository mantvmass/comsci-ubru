<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UBRU - สาขาวิทยาการคอมพิวเตอร์</title>
</head>
<body>
    <!-- 
        ตัวอย่างการนำเข้าไฟล์  css js img อืนๆ
        Key:
            href="{{ url_for('static', filename='path/css?js?png') }}"

        Example:
            <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
     -->
    <h1>หน้าแรก</h1>
    <button onclick="singin()">Sing in</button>
    <button onclick="singup()">Sing up</button>









    <!-- javascript -->
    <script src="{{ url_for('static', filename='vendor/jquery/jquery-3.6.0.js') }}"></script> <!-- Ajex -->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- sweetalert -->

    <!-- singin and singup -->
    <script type="text/javascript">
        function singin() {
            Swal.fire({
                title: 'SingIn Form',
                html: `
                    <input type="text" id="username" class="swal2-input" placeholder="Username">
                    <input type="password" id="password" class="swal2-input" placeholder="Password">
                    `,
                confirmButtonText: 'Sign in',
                focusConfirm: false,
                preConfirm: () => {
                    const username = Swal.getPopup().querySelector('#username').value
                    const password = Swal.getPopup().querySelector('#password').value
                    if (!username || !password) {
                        Swal.showValidationMessage(`Please enter username and password`)
                    }
                    return { username: username, password: password }
                }
                }).then((result) => {
                    $.ajax({  
                        method: 'POST',
                        url: '/singin', 
                        data: { username: result.value.username, password: result.value.password },
                        success: function(response) {
                            if (response == "success"){
                                let timerInterval
                                Swal.fire({
                                    title: 'Redirect',
                                    icon: 'success',
                                    html: 'จะเปลี่ยนเส็นทางในอีก <b></b>.',
                                    timer: 4000,
                                    timerProgressBar: true,
                                    didOpen: () => {
                                        Swal.showLoading()
                                        const b = Swal.getHtmlContainer().querySelector('b')
                                        timerInterval = setInterval(() => {
                                        b.textContent = Swal.getTimerLeft()
                                        }, 100)
                                    },
                                    willClose: () => {
                                        clearInterval(timerInterval)
                                    }
                                    }).then((result) => {
                                    /* Read more about handling dismissals below */
                                    if (result.dismiss === Swal.DismissReason.timer) {
                                        // console.log('I was closed by the timer')
                                        window.location.href = "/home"
                                    }
                                });
                            } else {
                                Swal.fire({
                                    title: 'เกิดข้อผิดพลาด!',
                                    text: response,
                                    icon: 'warning',
                                    confirmButtonText: 'ตกลง'
                                });
                            }
                        },
                        error: function(response){
                            Swal.fire({
                                title: 'เกิดข้อผิดพลาด!',
                                text: 'เกิดข้อผิดพลาดกรุณาลองใหม่อีกครั้งในภายหลัง!',
                                icon: 'error',
                                confirmButtonText: 'ตกลง'
                            });
                        }
                    });
                }
            )
        }



        function singup() {
            Swal.fire({
                title: 'SingUp Form',
                html: `
                    <input type="text" id="username" class="swal2-input" placeholder="Username">
                    <input type="email" id="email" class="swal2-input" placeholder="Email">
                    <input type="password" id="password" class="swal2-input" placeholder="Password">
                    <input type="password" id="re_password" class="swal2-input" placeholder="Re Password">
                    <input type="password" id="key" class="swal2-input" placeholder="Key">
                    `,
                confirmButtonText: 'Sign up',
                focusConfirm: false,
                preConfirm: () => {
                    const username = Swal.getPopup().querySelector('#username').value
                    const email = Swal.getPopup().querySelector('#email').value
                    const password = Swal.getPopup().querySelector('#password').value
                    const re_password = Swal.getPopup().querySelector('#re_password').value
                    const key = Swal.getPopup().querySelector('#key').value
                    if (!username || !password || !email || !re_password || !key) {
                        Swal.showValidationMessage(`Please compleate the infomation`)
                    }
                    if (password != re_password) {
                        Swal.showValidationMessage(`Incorrect password`)
                    }
                    return { username: username, email: email, password: password, key: key }
                }
                }).then((result) => {
                    $.ajax({  
                        method: 'POST',
                        url: '/singup', 
                        data: { username: result.value.username, email: result.value.email, password: result.value.password, key: result.value.key },
                        success: function(response) {
                            if (response == "success"){
                                Swal.fire({
                                    title: 'Success',
                                    icon: 'success',
                                    confirmButtonText: 'ตกลง'
                                });
                            } else {
                                Swal.fire({
                                    title: 'เกิดข้อผิดพลาด!',
                                    text: response,
                                    icon: 'warning',
                                    confirmButtonText: 'ตกลง'
                                });
                            }
                        },
                        error: function(response){
                            Swal.fire({
                                title: 'เกิดข้อผิดพลาด!',
                                text: 'เกิดข้อผิดพลาดกรุณาลองใหม่อีกครั้งในภายหลัง!',
                                icon: 'error',
                                confirmButtonText: 'ตกลง'
                            });
                        }
                    });
                }
            )
        }
    </script>



</body>
</html>